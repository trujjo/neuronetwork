<!DOCTYPE html>
<html>
<head>
    <title>Network Visualization</title>
    <script src="https://unpkg.com/neovis.js@2.0.2"></script>
    <style>
        body {
            background-color: #1e1e1e;
            color: #f0f0f0;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid #404040;
            padding: 0 20px;
        }

        .tab-button {
            padding: 10px 20px;
            background: #2a2a2a;
            border: none;
            color: #f0f0f0;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: background 0.3s;
        }

        .tab-button.active {
            background: #D35400;
        }

        .filter-section {
            padding: 20px;
            background: #2a2a2a;
            display: none;
            border-radius: 0 0 8px 8px;
        }

        .filter-section.active {
            display: block;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-group {
            background: #3a3a3a;
            padding: 10px;
            border-radius: 8px;
            min-width: 180px;
            flex: 1;
        }

        .filter-group-title {
            color: #f0f0f0;
            margin: 0 0 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .filter-btn {
            padding: 4px 10px;
            border: 1px solid #404040;
            border-radius: 15px;
            background: transparent;
            color: #f0f0f0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .filter-btn:hover {
            background: #404040;
        }

        .filter-btn.active {
            background: #D35400;
            border-color: #D35400;
        }

        .clear-btn {
            padding: 4px 8px;
            border: 1px solid #ff4444;
            border-radius: 12px;
            background: transparent;
            color: #ff4444;
            cursor: pointer;
            font-size: 12px;
        }

        .clear-btn:hover {
            background: #ff4444;
            color: white;
        }

        .filter-stats {
            color: #808080;
            font-size: 14px;
            padding: 10px 20px;
        }

        #viz {
            width: 100%;
            height: 600px;
            background: #2a2a2a;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="filter-tabs">
        <button class="tab-button active" data-tab="node-types">Node Types</button>
        <button class="tab-button" data-tab="locations">Locations</button>
    </div>

    <div id="node-types" class="filter-section active">
        <div class="filter-container">
            <div class="filter-group">
                <div class="filter-group-title">
                    <h3>Node Types</h3>
                    <button class="clear-btn" onclick="filterManager.clearNodeTypes()">Clear</button>
                </div>
                <div class="filter-buttons" id="nodeTypeFilters"></div>
            </div>
        </div>
        <div class="filter-stats" id="nodeTypeStats"></div>
    </div>

    <div id="locations" class="filter-section">
        <div class="filter-container" id="locationGroups"></div>
        <div class="filter-stats" id="locationStats"></div>
    </div>

    <div id="viz"></div>

    <script>
        const locationData = {
            'head': ['brain', 'eye', 'face', 'ear', 'nose', 'skull', 'mouth', 'head'],
            'neck': ['cervical spine', 'visceral', 'vascular'],
            'upper limb': ['wrist', 'hand', 'fingers', 'arm', 'forearm', 'elbow', 'shoulder'],
            'thorax': ['thoracic spine', 'ribcage', 'heart', 'lung'],
            'abdomen': ['lumbar spine', 'right upper quadrant', 'left upper quadrant', 'right lower quadrant', 'left lower quadrant'],
            'spine': ['spinal cord', 'vertebral', 'tracts', 'sacral spine'],
            'pelvis': ['sacral spine', 'greater pelvis', 'lesser pelvis'],
            'lower limb': ['foot', 'thigh', 'knee', 'leg', 'ankle', 'toes']
        };

        class FilterManager {
            constructor() {
                this.activeNodeTypes = new Set();
                this.activeLocations = new Set();
                this.activeSublocations = new Set();
                this.viz = new NeoViz();
                this.initializeTabs();
                this.initializeNodeTypes();
                this.initializeLocationGroups();
                this.updateStats();
            }

            initializeTabs() {
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                        document.querySelectorAll('.filter-section').forEach(s => s.classList.remove('active'));
                        button.classList.add('active');
                        document.getElementById(button.dataset.tab).classList.add('active');
                    });
                });
            }

            initializeNodeTypes() {
                const nodeTypes = ['nerve', 'bone', 'neuro', 'region', 'viscera', 'muscle', 'sense', 
                                 'vein', 'artery', 'cv', 'function', 'sensory', 'gland', 'lymph', 
                                 'head', 'organ', 'sensation', 'skin'];
                const container = document.getElementById('nodeTypeFilters');
                nodeTypes.forEach(type => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-type', type);
                    button.textContent = type;
                    button.onclick = () => this.toggleNodeType(button);
                    container.appendChild(button);
                });
            }

            initializeLocationGroups() {
                const container = document.getElementById('locationGroups');
                Object.entries(locationData).forEach(([location, sublocations]) => {
                    const group = this.createLocationGroup(location, sublocations);
                    container.appendChild(group);
                });
            }

            createLocationGroup(location, sublocations) {
                const group = document.createElement('div');
                group.className = 'filter-group';
                
                const header = document.createElement('div');
                header.className = 'filter-group-title';
                
                const title = document.createElement('h3');
                title.textContent = location;
                title.onclick = () => this.toggleLocationGroup(location);
                
                const clearBtn = document.createElement('button');
                clearBtn.className = 'clear-btn';
                clearBtn.textContent = 'Clear';
                clearBtn.onclick = (e) => {
                    e.stopPropagation();
                    this.clearLocationGroup(location);
                };
                
                header.appendChild(title);
                header.appendChild(clearBtn);
                
                const buttons = document.createElement('div');
                buttons.className = 'filter-buttons';
                
                sublocations.forEach(sublocation => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn';
                    button.setAttribute('data-location', location);
                    button.setAttribute('data-sublocation', sublocation);
                    button.textContent = sublocation;
                    button.onclick = () => this.toggleSublocation(button);
                    buttons.appendChild(button);
                });
                
                group.appendChild(header);
                group.appendChild(buttons);
                return group;
            }

            toggleNodeType(button) {
                const type = button.dataset.type;
                if (button.classList.contains('active')) {
                    this.activeNodeTypes.delete(type);
                    button.classList.remove('active');
                } else {
                    this.activeNodeTypes.add(type);
                    button.classList.add('active');
                }
                this.updateVisualization();
                this.updateStats();
            }

            toggleLocationGroup(location) {
                const buttons = document.querySelectorAll(`[data-location="${location}"]`);
                const allActive = Array.from(buttons).every(btn => btn.classList.contains('active'));
                
                buttons.forEach(button => {
                    const sublocation = button.dataset.sublocation;
                    if (allActive) {
                        this.activeSublocations.delete(sublocation);
                        button.classList.remove('active');
                    } else {
                        this.activeSublocations.add(sublocation);
                        button.classList.add('active');
                    }
                });

                if (allActive) {
                    this.activeLocations.delete(location);
                } else {
                    this.activeLocations.add(location);
                }
                
                this.updateVisualization();
                this.updateStats();
            }

            toggleSublocation(button) {
                const location = button.dataset.location;
                const sublocation = button.dataset.sublocation;
                
                if (button.classList.contains('active')) {
                    this.activeSublocations.delete(sublocation);
                    button.classList.remove('active');
                    if (!document.querySelectorAll(`[data-location="${location}"].active`).length) {
                        this.activeLocations.delete(location);
                    }
                } else {
                    this.activeSublocations.add(sublocation);
                    button.classList.add('active');
                    this.activeLocations.add(location);
                }
                
                this.updateVisualization();
                this.updateStats();
            }

            clearNodeTypes() {
                this.activeNodeTypes.clear();
                document.querySelectorAll('#nodeTypeFilters .filter-btn').forEach(button => {
                    button.classList.remove('active');
                });
                this.updateVisualization();
                this.updateStats();
            }

            clearLocationGroup(location) {
                const buttons = document.querySelectorAll(`[data-location="${location}"]`);
                buttons.forEach(button => {
                    const sublocation = button.dataset.sublocation;
                    this.activeSublocations.delete(sublocation);
                    button.classList.remove('active');
                });
                this.activeLocations.delete(location);
                this.updateVisualization();
                this.updateStats();
            }

            updateStats() {
                document.getElementById('nodeTypeStats').textContent = 
                    `${this.activeNodeTypes.size} node types selected`;
                document.getElementById('locationStats').textContent = 
                    `${this.activeSublocations.size} locations selected`;
            }

            updateVisualization() {
                const filters = {
                    nodeTypes: Array.from(this.activeNodeTypes),
                    locations: Array.from(this.activeLocations),
                    sublocations: Array.from(this.activeSublocations)
                };
                
                this.viz.updateWithFilters(filters);
            }
        }

        // Initialize the filter manager when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.filterManager = new FilterManager();
        });
    </script>
</body>
</html>
